if(NOT OBJS)
  return()
endif()

message(STATUS "OBJS = ${OBJS}")
list(LENGTH OBJS OBJS_LEN)
message(STATUS "OBJS_LEN = ${OBJS_LEN}")
list(GET OBJS 0 OBJS)
message(STATUS "Before REMOVE_FILENAME OBJS = ${OBJS}")
cmake_path(REMOVE_FILENAME OBJS OUTPUT_VARIABLE objdir)
message(STATUS "After REMOVE_FILENAME objdir = ${objdir}")
cmake_path(APPEND objdir "*.mod" OUTPUT_VARIABLE modpattern)
message(STATUS "Before GLOB")
file(GLOB modfiles LIST_DIRECTORIES false ${modpattern})
message(STATUS "Fortran modules: ${modfiles}")
file(COPY ${modfiles} DESTINATION ${CMAKE_CURRENT_LIST_DIR})
message(STATUS "Copied Fortran modules to ${CMAKE_CURRENT_LIST_DIR}")

if (WIN32)
  cmake_path(APPEND objdir "*.def" OUTPUT_VARIABLE defpattern)
  file(GLOB deffiles LIST_DIRECTORIES false ${defpattern})
  message(STATUS "Fortran exports file: ${deffiles}")
  file(COPY ${deffiles} DESTINATION ${CMAKE_CURRENT_LIST_DIR})
  message(STATUS "Copied Fortran exports file to ${CMAKE_CURRENT_LIST_DIR}")
endif()
